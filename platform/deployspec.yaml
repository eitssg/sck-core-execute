{# 

aws cloudformation deploy \
  --template-file core_execute_cf.yaml \
  --stack-name core-execute-stack \
  --parameter-overrides \
    Client=myclient \
    Environment=prod \
    AlertEmail=ops@company.com \
    PipelineProvisioningRoleArn=arn:aws:iam::123456789012:role/pipeline-role \
    LambdaCodeBucket=my-lambda-bucket \
    LambdaCodeKey=core-execute-1.0.0.zip \
  --capabilities CAPABILITY_NAMED_IAM 
  
  #}

- apiVersion: v1
  kind: create-stack
  metadata:
    name: core-automation-step-function
    namespace: core
    description: Create the core automation step function
  params:
    stack_name: {{ Scope }}{{ Client }}-core-automation-step-function
    template_url: core_execute_cf.yaml
    account: {{ AutomationAccountId }}
    region: {{ Region }}
    parameters:
      Client: {{ Client }}
      Environment: {{ Environment }}
      AlertEmail: {{ AlertEmail }}
      PipelineProvisioningRoleArn: {{ PipelineProvisioningRoleArn }}
      AutomationAccountId: {{ AutomationAccountId }}
      IsAutomationAccount: {{ IsAutomationAccount }}
      LambdaCodeBucket: {{ LambdaCodeBucket }}
      LambdaCodeKey: core-execute-{{ Build }}.zip
    tags:
      Client: {{ Client }}
      Environment: {{ Environment }}
      Build: {{ Build }}
  depends_on: []
